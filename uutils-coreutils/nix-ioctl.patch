From 705429f8554b24df94582e24ad80993db713092a Mon Sep 17 00:00:00 2001
From: 500-internal-server-error
 <76838083+500-internal-server-error@users.noreply.github.com>
Date: Tue, 16 Dec 2025 22:14:58 +0700
Subject: [PATCH 1/2] ioctl: add support for cygwin

https://github.com/msys2/msys2-runtime/blob/msys2-3.6.5/winsup/cygwin/include/sys/ioctl.h
---
 src/sys/ioctl/linux.rs |  3 +++
 src/sys/ioctl/mod.rs   | 14 ++++++++++++--
 src/sys/mod.rs         |  1 +
 3 files changed, 16 insertions(+), 2 deletions(-)

diff --git a/src/sys/ioctl/linux.rs b/src/sys/ioctl/linux.rs
index 314b1c9b6f..067996d6d4 100644
--- a/src/sys/ioctl/linux.rs
+++ b/src/sys/ioctl/linux.rs
@@ -4,6 +4,7 @@ use cfg_if::cfg_if;
 #[cfg(any(
     target_os = "android",
     target_os = "fuchsia",
+    target_os = "cygwin",
     target_env = "musl",
     target_env = "ohos"
 ))]
@@ -12,12 +13,14 @@ pub type ioctl_num_type = ::libc::c_int;
 #[cfg(not(any(
     target_os = "android",
     target_os = "fuchsia",
+    target_os = "cygwin",
     target_env = "musl",
     target_env = "ohos"
 )))]
 #[doc(hidden)]
 pub type ioctl_num_type = ::libc::c_ulong;
 /// The datatype used for the 3rd argument
+#[cfg(not(target_os = "cygwin"))]
 #[doc(hidden)]
 pub type ioctl_param_type = ::libc::c_ulong;
 
diff --git a/src/sys/ioctl/mod.rs b/src/sys/ioctl/mod.rs
index aab48192f5..f8bf61652b 100644
--- a/src/sys/ioctl/mod.rs
+++ b/src/sys/ioctl/mod.rs
@@ -227,11 +227,21 @@
 //! ```
 use cfg_if::cfg_if;
 
-#[cfg(any(linux_android, target_os = "fuchsia", target_os = "redox"))]
+#[cfg(any(
+    linux_android,
+    target_os = "fuchsia",
+    target_os = "redox",
+    target_os = "cygwin"
+))]
 #[macro_use]
 mod linux;
 
-#[cfg(any(linux_android, target_os = "fuchsia", target_os = "redox"))]
+#[cfg(any(
+    linux_android,
+    target_os = "fuchsia",
+    target_os = "redox",
+    target_os = "cygwin"
+))]
 pub use self::linux::*;
 
 #[cfg(any(bsd, solarish, target_os = "haiku",))]
diff --git a/src/sys/mod.rs b/src/sys/mod.rs
index ad5cbcd7e0..07b52d630c 100644
--- a/src/sys/mod.rs
+++ b/src/sys/mod.rs
@@ -40,6 +40,7 @@ feature! {
     solarish,
     target_os = "fuchsia",
     target_os = "redox",
+    target_os = "cygwin",
 ))]
 #[cfg(feature = "ioctl")]
 #[cfg_attr(docsrs, doc(cfg(feature = "ioctl")))]
