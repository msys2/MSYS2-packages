# Maintainer: Alexey Pavlov <alexpux@gmail.com>

_realname=setuptools
pkgbase="python-${_realname}"
pkgname=("python-${_realname}")
pkgver=80.7.1
pkgrel=1
pkgdesc="Easily download, build, install, upgrade, and uninstall Python packages"
arch=('any')
license=('PSF')
url="https://pypi.python.org/pypi/setuptools"
msys2_repository_url="https://github.com/pypa/setuptools"
msys2_references=(
  "anitya: 4021"
  "purl: pkg:pypi/setuptools"
  "cpe: cpe:/a:python:setuptools"
)
depends=('python')
source=("${_realname}-${pkgver}.tar.gz::https://github.com/pypa/setuptools/archive/v${pkgver}.tar.gz")
sha256sums=('c55d5785c669ef960971da78b3e89bbb46c9b08f2687342304013e942304f745')

build() {
  cd "${srcdir}/setuptools-${pkgver}"

  python setup.py egg_info
  python setup.py build
}

check() { (
  # Workaround UTF-8 tests by setting LC_CTYPE
  export LC_CTYPE=en_US.UTF-8

  # https://github.com/pypa/setuptools/pull/810
  export PYTHONDONTWRITEBYTECODE=1

  # Check python module
  # cd "${srcdir}/setuptools-${pkgver}"
  # /usr/bin/python setup.py pytest
)}

package() {
  cd "${srcdir}/setuptools-${pkgver}"

  python setup.py install --prefix=/usr --root="$pkgdir" --skip-build

  # Remove all .exe files
  find "$pkgdir" -type f -name '*.exe' -delete
}
