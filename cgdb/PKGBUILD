# Maintainer: Alexey Pavlov <alexpux@gmail.com>

pkgname=cgdb
pkgver=0.8.0
pkgrel=3
pkgdesc="Curses-based interface to the GNU Debugger"
arch=('i686' 'x86_64')
url="https://cgdb.sourceforge.io/"
license=('GPL')
depends=('libreadline' 'ncurses' 'gdb')
makedepends=('help2man' 'libreadline-devel' 'ncurses-devel' 'autotools' 'gcc')
source=("https://cgdb.me/files/${pkgname}-${pkgver}.tar.gz"
        01-msysize.patch
        10-ncursesw-link-tinfow.patch)
sha512sums=('0f53798707f20508a8ea564d5ed3f82e223edf4b246468c9a99c929c043b2b2eb333e96395b66672a38da1e517efb7c7dec011a29ea774d873ddf81fb56e4d9a'
            '31d2f2573fec3e6569b0c236d60898e5fced21bd3510add98613ce2e75f966a923917ed6eeec475844c3545004d0a17b55de96cfa3eb6f68d5a84636c563ef0e'
            '0e905af78ddc55f2d57cc9a64a7180f0605d9756caa1d6621def5e26cc445c8327673824506b8790d64f8fa15aa175216ff3f13506b0dea0e44a5df99425afa4')
install=cgdb.install

prepare() {
  cd ${srcdir}/${pkgname}-${pkgver}
  patch -p1 -i ${srcdir}/01-msysize.patch
  patch -p1 -i ${srcdir}/10-ncursesw-link-tinfow.patch

  autoreconf -fi -I config
}

build() {
  cd ${srcdir}/${pkgname}-${pkgver}
  CFLAGS+=" -D_GNU_SOURCE"
  CXXFLAGS+=" -std=c++11 -D_GNU_SOURCE"
  ./configure \
    --prefix=/usr \
    --build=${CHOST} \
    --with-readline=/usr \
    --with-ncurses=/usr
  make
}

package() {
  cd ${srcdir}/${pkgname}-${pkgver}
  make DESTDIR="${pkgdir}/" install
}
